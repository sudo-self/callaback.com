import{d as vt,f as x,a as w,s as $,c as ut}from"../chunks/kngTHrYm.js";import{o as ft}from"../chunks/QMVcuV15.js";import{a7 as pt,ae as U,af as ht,ac as l,a9 as L,aa as gt,s as n,g as a,ab as u,ad as d,a8 as mt}from"../chunks/DhHtmFCV.js";import{i as Y}from"../chunks/BKlt1PlW.js";import{e as tt,r as et,s as at}from"../chunks/BtudUlw-.js";import{t as q,a as rt,c as _t}from"../chunks/DMzgk5bG.js";import{c as yt,q as wt}from"../chunks/Ccw7PXcW.js";function st(h,{from:f,to:v},H={}){var{delay:i=0,duration:p=m=>Math.sqrt(m)*120,easing:c=yt}=H,g=getComputedStyle(h),j=g.transform==="none"?"":g.transform,[C,k]=g.transformOrigin.split(" ").map(parseFloat);C/=h.clientWidth,k/=h.clientHeight;var F=bt(h),M=h.clientWidth/v.width/F,N=h.clientHeight/v.height/F,J=f.left+f.width*C,D=f.top+f.height*k,z=v.left+v.width*C,W=v.top+v.height*k,b=(J-z)*M,E=(D-W)*N,Z=f.width/v.width,B=f.height/v.height;return{delay:i,duration:typeof p=="function"?p(Math.sqrt(b*b+E*E)):p,easing:c,css:(m,_)=>{var O=_*b,A=_*E,S=m+_*Z,P=m+_*B;return`transform: ${j} translate(${O}px, ${A}px) scale(${S}, ${P});`}}}function bt(h){if("currentCSSZoom"in h)return h.currentCSSZoom;for(var f=h,v=1;f!==null;)v*=+getComputedStyle(f).zoom,f=f.parentElement;return v}var Tt=x('<div class="loading svelte-1g7fi1p">Loading todos from Cloudflare D1...</div>'),$t=x('<div class="error svelte-1g7fi1p"><strong>Error:</strong> <button class="retry-btn svelte-1g7fi1p">Retry</button></div>'),xt=x('<label class="svelte-1g7fi1p"><input type="checkbox" class="svelte-1g7fi1p"/> <span class="description svelte-1g7fi1p"> </span> <button class="svelte-1g7fi1p">x</button></label>'),kt=x('<div class="empty-state svelte-1g7fi1p">All done! ðŸŽ‰</div>'),Et=x('<label class="svelte-1g7fi1p"><input type="checkbox" class="svelte-1g7fi1p"/> <span class="description svelte-1g7fi1p"> </span> <button class="svelte-1g7fi1p">x</button></label>'),Ct=x('<div class="empty-state svelte-1g7fi1p">Nothing completed yet</div>'),Ft=x('<div class="board svelte-1g7fi1p"><!> <div class="controls svelte-1g7fi1p"><input class="new-todo svelte-1g7fi1p" placeholder="what needs to be done?"/> <div class="action-buttons svelte-1g7fi1p"><button class="secondary svelte-1g7fi1p">Clear Completed</button></div></div> <div class="columns svelte-1g7fi1p"><div class="left svelte-1g7fi1p"><h2 class="svelte-1g7fi1p"> </h2> <!></div> <div class="right svelte-1g7fi1p"><h2 class="svelte-1g7fi1p"> </h2> <!></div></div> <div class="stats svelte-1g7fi1p"><small> <span class="db-status svelte-1g7fi1p"> </span></small></div></div>');function At(h,f){pt(f,!0);const[v,H]=_t({fallback(t,e){const r=getComputedStyle(t),s=r.transform==="none"?"":r.transform;return{duration:600,easing:wt,css:o=>`
                    transform: ${s} scale(${o});
                    opacity: ${o}
                `}}});let i=U(ht([])),p=U(!0),c=U(null);const g="/api";async function j(){try{n(c,null);const t=await fetch(`${g}/todos`);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const e=await t.json();if(!e.success)throw new Error(e.error||"Failed to load todos");n(i,e.data||[],!0),a(i).length===0&&await C()}catch(t){console.error("Failed to load todos:",t),n(c,t.message,!0),n(i,k(),!0)}}async function C(){const t=k();try{for(const e of t)await F(e);n(i,t,!0)}catch(e){console.error("Failed to initialize default todos:",e),n(i,t,!0)}}function k(){return[{id:1,done:!1,description:"write some docs"},{id:2,done:!1,description:"finish cloudflare integration"},{id:3,done:!0,description:"add a billing account"},{id:4,done:!1,description:"create a svelte page"},{id:5,done:!1,description:"create logins"},{id:6,done:!1,description:"establish r2 bucket"}]}async function F(t){try{const e=t.id?"PUT":"POST",r=t.id?`${g}/todos/${t.id}`:`${g}/todos`,s=await fetch(r,{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify({description:t.description,done:t.done})});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const o=await s.json();if(!o.success)throw new Error(o.error||"Failed to save todo");return o.data}catch(e){throw console.error("Failed to save todo:",e),e}}async function M(t){try{const e=await fetch(`${g}/todos/${t}`,{method:"DELETE"});if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const r=await e.json();if(!r.success)throw new Error(r.error||"Failed to delete todo");return r}catch(e){throw console.error("Failed to delete todo:",e),e}}async function N(){try{const t=await fetch(`${g}/todos`,{method:"DELETE"});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const e=await t.json();if(!e.success)throw new Error(e.error||"Failed to clear completed todos");n(i,e.data||[],!0)}catch(t){throw console.error("Failed to clear completed todos:",t),t}}ft(async()=>{await j(),n(p,!1)});async function J(t){const e=t.target,r=e.value.trim();if(r)try{n(c,null);const o=await F({description:r,done:!1});n(i,[o,...a(i)],!0),e.value=""}catch(s){console.error("Failed to add todo:",s),n(c,s.message,!0)}}async function D(t){try{n(c,null),await M(t.id),n(i,a(i).filter(e=>e.id!==t.id),!0)}catch(e){console.error("Failed to remove todo:",e),n(c,e.message,!0)}}async function z(t){try{n(c,null);const e={...t,done:!t.done},r=await fetch(`${g}/todos/${t.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({done:e.done})});if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);const s=await r.json();if(!s.success)throw new Error(s.error||"Failed to update todo");n(i,a(i).map(o=>o.id===t.id?s.data:o),!0)}catch(e){console.error("Failed to toggle todo:",e),n(c,e.message,!0),n(i,[...a(i)],!0)}}async function W(){try{n(c,null),await N()}catch(t){console.error("Failed to clear completed todos:",t),n(c,t.message,!0)}}var b=Ft(),E=l(b);{var Z=t=>{var e=Tt();w(t,e)},B=t=>{var e=ut(),r=mt(e);{var s=o=>{var T=$t(),y=u(l(T)),ct=u(y);ct.__click=()=>{n(c,null),j()},d(T),L(()=>$(y,` ${a(c)??""} `)),w(o,T)};Y(r,o=>{a(c)&&o(s)},!0)}w(t,e)};Y(E,t=>{a(p)?t(Z):t(B,!1)})}var m=u(E,2),_=l(m);_.__keydown=t=>t.key==="Enter"&&J(t);var O=u(_,2),A=l(O);A.__click=W,d(O),d(m);var S=u(m,2),P=l(S),I=l(P),ot=l(I);d(I);var it=u(I,2);tt(it,25,()=>a(i).filter(t=>!t.done),t=>t.id,(t,e)=>{var r=xt(),s=l(r);et(s),s.__change=()=>z(a(e));var o=u(s,2),T=l(o,!0);d(o);var y=u(o,2);y.__click=()=>D(a(e)),d(r),L(()=>{at(s,a(e).done),s.disabled=a(p),$(T,a(e).description),y.disabled=a(p)}),q(1,r,()=>H,()=>({key:a(e).id})),q(2,r,()=>v,()=>({key:a(e).id})),rt(r,()=>st,null),w(t,r)},t=>{var e=kt();w(t,e)}),d(P);var G=u(P,2),R=l(G),nt=l(R);d(R);var lt=u(R,2);tt(lt,25,()=>a(i).filter(t=>t.done),t=>t.id,(t,e)=>{var r=Et(),s=l(r);et(s),s.__change=()=>z(a(e));var o=u(s,2),T=l(o,!0);d(o);var y=u(o,2);y.__click=()=>D(a(e)),d(r),L(()=>{at(s,a(e).done),s.disabled=a(p),$(T,a(e).description),y.disabled=a(p)}),q(1,r,()=>H,()=>({key:a(e).id})),q(2,r,()=>v,()=>({key:a(e).id})),rt(r,()=>st,null),w(t,r)},t=>{var e=Ct();w(t,e)}),d(G),d(S);var K=u(S,2),Q=l(K),V=l(Q),X=u(V),dt=l(X,!0);d(X),d(Q),d(K),d(b),L((t,e,r,s,o)=>{_.disabled=a(p),A.disabled=t,$(ot,`todo (${e??""})`),$(nt,`done (${r??""})`),$(V,`Total: ${a(i).length??""} |
            Todo: ${s??""} |
            Done: ${o??""} | `),$(dt,a(p)?"Loading...":"Connected to Cloudflare D1")},[()=>!a(i).some(t=>t.done)||a(p),()=>a(i).filter(t=>!t.done).length,()=>a(i).filter(t=>t.done).length,()=>a(i).filter(t=>!t.done).length,()=>a(i).filter(t=>t.done).length]),w(h,b),gt()}vt(["click","keydown","change"]);export{At as component};
