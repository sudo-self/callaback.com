import{d as vt,f as x,a as w,s as $,c as ut}from"../chunks/D9sge_RQ.js";import{o as ft}from"../chunks/DX4UBx9p.js";import{J as pt,Q as K,R as ht,O as l,L as A,M as gt,s as n,g as r,N as u,P as d,K as mt}from"../chunks/RazRtEcl.js";import{i as Y}from"../chunks/DyF937Oy.js";import{c as _t,e as tt,r as et,s as rt,q as yt}from"../chunks/CJbfPhj0.js";import{t as q,a as at,c as wt}from"../chunks/oYL55Fdm.js";function st(h,{from:f,to:v},H={}){var{delay:i=0,duration:p=m=>Math.sqrt(m)*120,easing:c=_t}=H,g=getComputedStyle(h),j=g.transform==="none"?"":g.transform,[C,k]=g.transformOrigin.split(" ").map(parseFloat);C/=h.clientWidth,k/=h.clientHeight;var F=bt(h),M=h.clientWidth/v.width/F,N=h.clientHeight/v.height/F,J=f.left+f.width*C,D=f.top+f.height*k,O=v.left+v.width*C,R=v.top+v.height*k,b=(J-O)*M,E=(D-R)*N,W=f.width/v.width,Z=f.height/v.height;return{delay:i,duration:typeof p=="function"?p(Math.sqrt(b*b+E*E)):p,easing:c,css:(m,_)=>{var z=_*b,L=_*E,S=m+_*W,P=m+_*Z;return`transform: ${j} translate(${z}px, ${L}px) scale(${S}, ${P});`}}}function bt(h){if("currentCSSZoom"in h)return h.currentCSSZoom;for(var f=h,v=1;f!==null;)v*=+getComputedStyle(f).zoom,f=f.parentElement;return v}var Tt=x('<div class="loading svelte-1g7fi1p">Loading todos from Cloudflare D1...</div>'),$t=x('<div class="error svelte-1g7fi1p"><strong>Error:</strong> <button class="retry-btn svelte-1g7fi1p">Retry</button></div>'),xt=x('<label class="svelte-1g7fi1p"><input type="checkbox" class="svelte-1g7fi1p"/> <span class="description svelte-1g7fi1p"> </span> <button class="svelte-1g7fi1p">x</button></label>'),kt=x('<div class="empty-state svelte-1g7fi1p">All done! ðŸŽ‰</div>'),Et=x('<label class="svelte-1g7fi1p"><input type="checkbox" class="svelte-1g7fi1p"/> <span class="description svelte-1g7fi1p"> </span> <button class="svelte-1g7fi1p">x</button></label>'),Ct=x('<div class="empty-state svelte-1g7fi1p">Nothing completed yet</div>'),Ft=x('<div class="board svelte-1g7fi1p"><!> <div class="controls svelte-1g7fi1p"><input class="new-todo svelte-1g7fi1p" placeholder="what needs to be done?"/> <div class="action-buttons svelte-1g7fi1p"><button class="secondary svelte-1g7fi1p">Clear Completed</button></div></div> <div class="columns svelte-1g7fi1p"><div class="left svelte-1g7fi1p"><h2 class="svelte-1g7fi1p"> </h2> <!></div> <div class="right svelte-1g7fi1p"><h2 class="svelte-1g7fi1p"> </h2> <!></div></div> <div class="stats svelte-1g7fi1p"><small> <span class="db-status svelte-1g7fi1p"> </span></small></div></div>');function zt(h,f){pt(f,!0);const[v,H]=wt({fallback(t,e){const a=getComputedStyle(t),s=a.transform==="none"?"":a.transform;return{duration:600,easing:yt,css:o=>`
                    transform: ${s} scale(${o});
                    opacity: ${o}
                `}}});let i=K(ht([])),p=K(!0),c=K(null);const g="/api";async function j(){try{n(c,null);const t=await fetch(`${g}/todos`);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const e=await t.json();if(!e.success)throw new Error(e.error||"Failed to load todos");n(i,e.data||[],!0),r(i).length===0&&await C()}catch(t){console.error("Failed to load todos:",t),n(c,t.message,!0),n(i,k(),!0)}}async function C(){const t=k();try{for(const e of t)await F(e);n(i,t,!0)}catch(e){console.error("Failed to initialize default todos:",e),n(i,t,!0)}}function k(){return[{id:1,done:!1,description:"write some docs"},{id:2,done:!1,description:"finish cloudflare integration"},{id:3,done:!0,description:"add a billing account"},{id:4,done:!1,description:"create a svelte page"},{id:5,done:!1,description:"create logins"},{id:6,done:!1,description:"establish r2 bucket"}]}async function F(t){try{const e=t.id?"PUT":"POST",a=t.id?`${g}/todos/${t.id}`:`${g}/todos`,s=await fetch(a,{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify({description:t.description,done:t.done})});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const o=await s.json();if(!o.success)throw new Error(o.error||"Failed to save todo");return o.data}catch(e){throw console.error("Failed to save todo:",e),e}}async function M(t){try{const e=await fetch(`${g}/todos/${t}`,{method:"DELETE"});if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const a=await e.json();if(!a.success)throw new Error(a.error||"Failed to delete todo");return a}catch(e){throw console.error("Failed to delete todo:",e),e}}async function N(){try{const t=await fetch(`${g}/todos`,{method:"DELETE"});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const e=await t.json();if(!e.success)throw new Error(e.error||"Failed to clear completed todos");n(i,e.data||[],!0)}catch(t){throw console.error("Failed to clear completed todos:",t),t}}ft(async()=>{await j(),n(p,!1)});async function J(t){const e=t.target,a=e.value.trim();if(a)try{n(c,null);const o=await F({description:a,done:!1});n(i,[o,...r(i)],!0),e.value=""}catch(s){console.error("Failed to add todo:",s),n(c,s.message,!0)}}async function D(t){try{n(c,null),await M(t.id),n(i,r(i).filter(e=>e.id!==t.id),!0)}catch(e){console.error("Failed to remove todo:",e),n(c,e.message,!0)}}async function O(t){try{n(c,null);const e={...t,done:!t.done},a=await fetch(`${g}/todos/${t.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({done:e.done})});if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const s=await a.json();if(!s.success)throw new Error(s.error||"Failed to update todo");n(i,r(i).map(o=>o.id===t.id?s.data:o),!0)}catch(e){console.error("Failed to toggle todo:",e),n(c,e.message,!0),n(i,[...r(i)],!0)}}async function R(){try{n(c,null),await N()}catch(t){console.error("Failed to clear completed todos:",t),n(c,t.message,!0)}}var b=Ft(),E=l(b);{var W=t=>{var e=Tt();w(t,e)},Z=t=>{var e=ut(),a=mt(e);{var s=o=>{var T=$t(),y=u(l(T)),ct=u(y);ct.__click=()=>{n(c,null),j()},d(T),A(()=>$(y,` ${r(c)??""} `)),w(o,T)};Y(a,o=>{r(c)&&o(s)},!0)}w(t,e)};Y(E,t=>{r(p)?t(W):t(Z,!1)})}var m=u(E,2),_=l(m);_.__keydown=t=>t.key==="Enter"&&J(t);var z=u(_,2),L=l(z);L.__click=R,d(z),d(m);var S=u(m,2),P=l(S),B=l(P),ot=l(B);d(B);var it=u(B,2);tt(it,25,()=>r(i).filter(t=>!t.done),t=>t.id,(t,e)=>{var a=xt(),s=l(a);et(s),s.__change=()=>O(r(e));var o=u(s,2),T=l(o,!0);d(o);var y=u(o,2);y.__click=()=>D(r(e)),d(a),A(()=>{rt(s,r(e).done),s.disabled=r(p),$(T,r(e).description),y.disabled=r(p)}),q(1,a,()=>H,()=>({key:r(e).id})),q(2,a,()=>v,()=>({key:r(e).id})),at(a,()=>st,null),w(t,a)},t=>{var e=kt();w(t,e)}),d(P);var Q=u(P,2),I=l(Q),nt=l(I);d(I);var lt=u(I,2);tt(lt,25,()=>r(i).filter(t=>t.done),t=>t.id,(t,e)=>{var a=Et(),s=l(a);et(s),s.__change=()=>O(r(e));var o=u(s,2),T=l(o,!0);d(o);var y=u(o,2);y.__click=()=>D(r(e)),d(a),A(()=>{rt(s,r(e).done),s.disabled=r(p),$(T,r(e).description),y.disabled=r(p)}),q(1,a,()=>H,()=>({key:r(e).id})),q(2,a,()=>v,()=>({key:r(e).id})),at(a,()=>st,null),w(t,a)},t=>{var e=Ct();w(t,e)}),d(Q),d(S);var U=u(S,2),G=l(U),V=l(G),X=u(V),dt=l(X,!0);d(X),d(G),d(U),d(b),A((t,e,a,s,o)=>{_.disabled=r(p),L.disabled=t,$(ot,`todo (${e??""})`),$(nt,`done (${a??""})`),$(V,`Total: ${r(i).length??""} |
            Todo: ${s??""} |
            Done: ${o??""} | `),$(dt,r(p)?"Loading...":"Connected to Cloudflare D1")},[()=>!r(i).some(t=>t.done)||r(p),()=>r(i).filter(t=>!t.done).length,()=>r(i).filter(t=>t.done).length,()=>r(i).filter(t=>!t.done).length,()=>r(i).filter(t=>t.done).length]),w(h,b),gt()}vt(["click","keydown","change"]);export{zt as component};
