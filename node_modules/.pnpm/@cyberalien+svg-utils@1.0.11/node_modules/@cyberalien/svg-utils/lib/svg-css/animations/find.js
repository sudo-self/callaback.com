import { iterateXMLContent } from "../../xml/iterate.js";
import { svgAnimateMotionTag, svgAnimateTransformTag, svgAnimationTag, svgSetTag } from "./tags.js";
import { getAnimatedAttributeData } from "./attribute.js";
import { checkAnimationTagForCompatibility } from "./common.js";

/**
* Find all animations in SVG tree
*
* @todo Implement this
*/
function findAnimationsInSVGTree(root, options) {
	const animatedProperties = /* @__PURE__ */ new Map();
	let failed = false;
	const context = {
		failed,
		animatedProperties
	};
	iterateXMLContent(root, (node, stack) => {
		if (context.failed || node.type !== "tag") return;
		switch (node.tag) {
			case svgAnimateMotionTag:
				failed = true;
				return "abort";
			case svgAnimateTransformTag:
				if (!checkAnimationTagForCompatibility(node)) {
					failed = true;
					return "abort";
				}
				failed = true;
				return "abort";
			case svgSetTag:
			case svgAnimationTag:
				if (!checkAnimationTagForCompatibility(node)) {
					failed = true;
					return "abort";
				}
				break;
			default: return;
		}
		if (!getAnimatedAttributeData(node, stack, options.supportLegacyBrowsers)) {
			failed = true;
			return "abort";
		}
	});
	return failed ? { failed: true } : context;
}

export { findAnimationsInSVGTree };